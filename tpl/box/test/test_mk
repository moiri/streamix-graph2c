SHELL := /bin/bash

include ../config.mk

UPSTREAM_VERSION = $(VMAJ).$(VMIN).$(VREV)
BOXNAME = <box_name>

LOC_INC_DIR = ../include
LOC_SRC_DIR = ../src

TGT_INCLUDE = /opt/smx/include
TGT_LIB = /opt/smx/lib

SOURCES = $(wildcard $(LOC_SRC_DIR)/*.c) $(wildcard ./*.c)

INCLUDES = $(LOC_INC_DIR)/*.h \
		   ./*.h

INCLUDES_DIR = -I$(LOC_INC_DIR) \
			   -I/usr/include/libbson-1.0 \
			   -I$(TGT_INCLUDE) \
			   -I. $(EXT_INCS_DIR)

LINK_DIR = -L/usr/local/lib \
	-L$(TGT_LIB) $(EXT_LIBS_DIR)

LINK_FILE = -lsmxrts \
	-lpthread \
	-lzlog \
	-lbson $(EXT_LIBS)

CFLAGS = -Wall -DAPP_VERSION=\"$(UPSTREAM_VERSION)\" -DSMX_TESTING
DEBUG_FLAGS = -g -O0

CC = gcc

all: $(BOXNAME)

# compile with debug flags
debug: CFLAGS += $(DEBUG_FLAGS)
debug: all

$(BOXNAME): $(SOURCES) $(INCLUDES)
	$(CC) $(CFLAGS) $(SOURCES) $(INCLUDES_DIR) $(LINK_DIR) $(LINK_FILE) -o $@

.PHONY: clean run

clean:
	rm -f $(BOXNAME)

run:
	./$(BOXNAME)
